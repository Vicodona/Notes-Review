## MongoDB 特点

高性能、易部署、易使用，存储数据非常方便。

主要功能特性有：
+ 面向集合存储，易存储对象类型的数据
+ 模式自由
+ 支持动态查询
+ 支持完全索引，包含内部对象
+ 支持查询
+ 支持复制和故障恢复
+ 使用高效的二进制数据存储，包括大型对象（如视频等）
+ 自动处理碎片，以支持云计算层次的扩展性
+ 支持Python，PHP，Ruby，Java，C，C#，Javascript，Perl及C++语言的驱动程序，社区中也提供了对Erlang及.NET等平台的驱动程序
+ 文件存储格式为BSON（一种JSON的扩展）
+ 可通过网络访问

## 功能

+ 面向集合的存储：适合存储对象及JSON形式的数据。
+ 动态查询：Mongo支持丰富的查询表达式。查询指令使用JSON形式的标记，可轻易查询文档中内嵌的对象及数组。
+ 完整的索引支持：包括文档内嵌对象及数组。Mongo的查询优化器会分析查询表达式，并生成一个高效的查询计划。
+ 查询监视：Mongo包含一个监视工具用于分析数据库操作的性能。
+ 复制及自动故障转移：Mongo数据库支持服务器之间的数据复制，支持主-从模式及服务器之间的相互复制。复制的主要目标是提供冗余及自动故障转移。
+ 高效的传统存储方式：支持二进制数据及大型对象（如照片或图片）
+ 自动分片以支持云级别的伸缩性：自动分片功能支持水平的数据库集群，可动态添加额外的机器。

## MongoDB要注意的问题
+ 因为MongoDB是全索引的，所以它直接把索引放在内存中，因此最多支持2.5G的数据。如果是64位的会更多。
+ 因为没有恢复机制，因此要做好数据备份
+ 因为默认监听地址是127.0.0.1，因此要进行身份验证，否则不够安全；如果是自己使用，建议配置成localhost主机名
+ 通过GetLastError确保变更）

## 面试简述题
### 1. 什么是NoSQL数据库？NoSQL和RDBMS有什么区别？在哪些情况下使用和不使用NoSQL数据库？

NoSQL是非关系型数据库，NoSQL = Not Only SQL。

关系型数据库采用的结构化的数据，NoSQL采用的是键值对的方式存储数据。

在处理非结构化/半结构化的大数据时；在水平方向上进行扩展时；随时应对动态增加的数据项时可以优先考虑使用NoSQL数据库。

在考虑数据库的成熟度；支持；分析和商业智能；管理及专业性等问题时，应优先考虑关系型数据库。 

#### 2. 非关系型数据库有哪些？ 

Redis、MongoDB、Memcached、Hypertable 

#### 3. MySQL和MongoDB之间最基本的区别是什么？

关系型数据库与非关系型数据库的区别，即数据存储结构的不同。 

### 4. MongoDB的特点是什么？

（1）面向文档（2）高性能（3）高可用（4）易扩展（5）丰富的查询语言 

### 5. MongoDB支持存储过程吗？如果支持的话，怎么用？

 MongoDB支持存储过程，它是javascript写的，保存在db.system.js表中。 

### 6. 如何理解MongoDB中的GridFS机制，MongoDB为何使用GridFS来存储文件？

 GridFS是一种将大型文件存储在MongoDB中的文件规范。使用GridFS可以将大文件分隔成多个小文档存放，这样我们能够有效的保存大文档，而且解决了BSON对象有限制的问题。 

### 7. 为什么MongoDB的数据文件很大？

 MongoDB采用的预分配空间的方式来防止文件碎片。 

### 8. 当更新一个正在被迁移的块（Chunk）上的文档时会发生什么？

更新操作会立即发生在旧的块（Chunk）上，然后更改才会在所有权转移前复制到新的分片上。 

### 9. MongoDB在A:{B,C}上建立索引，查询A:{B,C}和A:{C,B}都会使用索引吗？

 不会，只会在A:{B,C}上使用索引。

#### 10. 如果一个分片（Shard）停止或很慢的时候，发起一个查询会怎样？ 

如果一个分片停止了，除非查询设置了“Partial”选项，否则查询会返回一个错误。如果一个分片响应很慢，MongoDB会等待它的响应。

 
#### 11. 如果用户移除对象的属性，该属性是否从存储层中删除?

是的，用户移除属性然后对象会重新保存(re-save())。

#### 12. 允许空值null吗?

对于对象成员而言，是的。然而用户不能够添加空值(null)到数据库集合(collection)因为空值不是对象。然而用户能够添加空对象{}。

#### 13. 跟新操作立刻 fsync 到磁盘

不会，磁盘写操作默认是延迟执行的。写操作可能在两三秒(默认在60秒内)后到达磁盘。例如，如果一秒内数据库收到一千个对一个对象递增的操作，仅刷新磁盘一次。(注意，尽管fsync选项在命令行和经过getLastError_old是有效的)(译者：也许是坑人的面试题??)。

#### 14. 如何执行事务/加锁
MongoDB 没有使用传统的锁或者复杂的带回滚的事务，因为它设计的宗旨是轻量，快速以及可预计的高性能。可以把它类比成 MySQL MylSAM 的自动提交模式。通过精简对事务的支持，性能得到了提升，特别是在一个可能会穿过多个服务器的系统里。

#### 15. 为什么我的数据文件如此庞大?

MongoDB会积极的预分配预留空间来防止文件系统碎片。

#### 16. 启用备份故障恢复需要多久
从备份数据库声明主数据库宕机到选出一个备份数据库作为新的主数据库将花费10到30秒时间。这期间在主数据库上的操作将会失败--包括写入和强一致性读取(strong consistent read)操作。然而，你还能在第二数据库上执行最终一致性查询(eventually consistent query)(在slaveOk模式下)，即使在这段时间里。

#### 17. 什么是 master 或 primary
它是当前备份集群(replica set)中负责处理所有写入操作的主要节点/成员。在一个备份集群中，当失效备援(failover)事件发生时，一个另外的成员会变成primary。

#### 18. 什么是secondary或slave?

Seconday从当前的primary上复制相应的操作。它是通过跟踪复制oplog(local.oplog.rs)做到的。

#### 19. 我必须调用getLastError来确保写操作生效了么?

不用。不管你有没有调用getLastError(又叫"Safe Mode")服务器做的操作都一样。调用getLastError只是为了确认写操作成功提交了。当然，你经常想得到确认，但是写操作的安全性和是否生效不是由这个决定的。

#### 20. 我应该启动一个集群分片(sharded)还是一个非集群分片的 MongoDB 环境?

为开发便捷起见，我们建议以非集群分片(unsharded)方式开始一个 MongoDB 环境，除非一台服务器不足以存放你的初始数据集。从非集群分片升级到集群分片(sharding)是无缝的，所以在你的数据集还不是很大的时候没必要考虑集群分片(sharding)。

#### 21. 分片(sharding)和复制(replication)是怎样工作的?

每一个分片(shard)是一个分区数据的逻辑集合。分片可能由单一服务器或者集群组成，我们推荐为每一个分片(shard)使用集群。

#### 22. 数据在什么时候才会扩展到多个分片(shard)里?

MongoDB 分片是基于区域(range)的。所以一个集合(collection)中的所有的对象都被存放到一个块(chunk)中。只有当存在多余一个块的时候，才会有多个分片获取数据的选项。现在，每个默认块的大小是 64Mb，所以你需要至少 64 Mb 空间才可以实施一个迁移。

#### 23. 当我试图更新一个正在被迁移的块(chunk)上的文档时会发生什么?

更新操作会立即发生在旧的分片(shard)上，然后更改才会在所有权转移(ownership transfers)前复制到新的分片上。

#### 24. 如果在一个分片(shard)停止或者很慢的时候，我发起一个查询会怎样?

如果一个分片(shard)停止了，除非查询设置了“Partial”选项，否则查询会返回一个错误。如果一个分片(shard)响应很慢，MongoDB则会等待它的响应。

#### 25. 我可以把moveChunk目录里的旧文件删除吗?

没问题，这些文件是在分片(shard)进行均衡操作(balancing)的时候产生的临时文件。一旦这些操作已经完成，相关的临时文件也应该被删除掉。但目前清理工作是需要手动的，所以请小心地考虑再释放这些文件的空间。

#### 26. 我怎么查看 Mongo 正在使用的链接?

db._adminCommand("connPoolStats");

#### 27. 如果块移动操作(moveChunk)失败了，我需要手动清除部分转移的文档吗?

不需要，移动操作是一致(consistent)并且是确定性的(deterministic);一次失败后，移动操作会不断重试;当完成后，数据只会出现在新的分片里(shard)。

#### 28. 如果我在使用复制技术(replication)，可以一部分使用日志(journaling)而其他部分则不使用吗?

可以。


#### 29. 分析器在 MongoDB 中的作用是什么？
分析器就是explain 显示每次操作性能特点的数据库分析器。mongodb中包括了一个可以显示数据库中每个操作性能特点的数据库分析器.通过这个分析器你可以找到比预期慢
的查询(或写操作);利用这一信息,比如,可以确定是否需要添加索引。

#### 30. 名字空间（namespace）是什么？
在collection中，数据库名+集合名叫做名字空间。也就是一个集合的完整名。
mongodb存储bson对象在丛集(collection)中.数据库名字和丛集名字以句点连结起来叫做名字空间(namespace).

一个集合命名空间又有多个数据域(extent)，集合命名空间里存储着集合的元数据，比如集合名称，集合的
第一个数据域和最后一个数据域的位置等等。而一个数据域由若干条文档(document)组成，每个数据域都有一个
头部，记录着第一条文档和最后一条文档的为知，以及该数据域的一些元数据。extent之间，document之间通过
双向链表连接。

索引的存储数据结构是B树，索引命名空间存储着对B树的根节点的指针。
  
#### 31. MongoDB 整体结构
键值对–》文档–》集合–》数据库

#### 32. 什么是集合(表)
集合就是一组 MongoDB 文档。它相当于关系型数据库（RDBMS）中的表这种概念。集合位于单独的一个数据库中。
一个集合内的多个文档可以有多个不同的字段。一般来说，集合中的文档都有着相同或相关的目的。
 

#### 33. 什么是文档(记录)
文档由一组key value组成。文档是动态模式,这意味着同一集合里的文档不需要有相同的字段和结构。在关系型
数据库中table中的每一条记录相当于MongoDB中的一个文

#### 34. monogodb 中的分片什么意思
分片是将数据水平切分到不同的物理节点。当应用数据越来越大的时候，数据量也会越来越大。当数据量增长
时，单台机器有可能无法存储数据或可接受的读取写入吞吐量。利用分片技术可以添加更多的机器来应对数据量增加
以及读写操作的要求。

#### 35. MongoDB支持主键外键关系吗
默认MongoDB不支持主键和外键关系。 用Mongodb本身的API需要硬编码才能实现外键关联，不够直观且难度
较大

#### 36. MongoDB支持哪些数据类型
+ String
+ Integer
+ Double
+ Boolean
+ Object
+ Object ID
+ Arrays
+ Min/Max Keys
+ Datetime
+ Code
+ Regular Expression等

#### 37.为什么要在MongoDB中用"Code"数据类型
"Code"类型用于在文档中存储 JavaScript 代码。

#### 38. 为什么要在MongoDB中用"Regular Expression"数据类型
"Regular Expression"类型用于在文档中存储正则表达式

#### 39. 为什么在MongoDB中使用"Object ID"数据类型
"ObjectID"数据类型用于存储文档id

#### 40. "ObjectID"有哪些部分组成
一共有四部分组成:时间戳、客户端ID、客户进程ID、三个字节的增量计数器

#### 41. 在MongoDb中什么是索引
索引用于高效的执行查询,没有索引的MongoDB将扫描整个集合中的所有文档,这种扫描效率很低,需要处理大量
的数据.

索引是一种特殊的数据结构,将一小块数据集合保存为容易遍历的形式.索引能够存储某种特殊字段或字段集的
值,并按照索引指定的方式将字段值进行排序.

#### 42. 如何添加索引
使用db.collection.createIndex()在集合中创建一个索引

#### 43. 如果查询集合中的文档
db.collectionName.find({key:value})

#### 44. 用什么方法可以格式化输出结果
db.collectionName.find().pretty()

#### 45.如何使用"AND"或"OR"条件循环查询集合中的文档
```
db.mycol.find(
   {
      $or: [
         {key1: value1}, {key2:value2}
      ]
   }
).pretty()

```

#### 46. 更新数据
```
db.collectionName.update({key:value},{$set:{newkey:newValue}})
```

#### 47. 如何删除文档
```
db.collectionName.remove({key:value})
```

#### 48. 在MongoDB中如何排序
并使用 1 和 -1 来指定排序方式，其中 1 表示升序，而 -1 表示降序。
```
db.connectionName.find({key:value}).sort({columnName:1})
```

#### 49. 什么是聚合
聚合操作能够处理数据记录并返回计算结果。聚合操作能将多个文档中的值组合起来，对成组数据执行各种操作，返回单一的结果。它相当于 SQL 中的 `count(*)` 组合 group by。对于 MongoDB 中的聚合操作，应该使用 aggregate()方法。
```
db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)
```

#### 50.  在MongoDB中什么是副本集（避免单点故障）
```
在MongoDB中副本集由一组MongoDB实例组成，包括一个主节点多个次节点，MongoDB客户端的所有数据都
写入主节点(Primary),副节点从主节点同步写入数据，以保持所有复制集内存储相同的数据，提高数据可用性。
```

#### 51. 我应该启动一个集群分片(sharded)还是一个非集群分片的 mongodb 环境?
(数据量大用集群分片,数据量小用非集群)

为开发便捷起见,我们建议以非集群分片(unsharded)方式开始一个 mongodb 环境,除非一台服务器不足以存放你的初始数据集.从非集群分片升级到集群分片(sharding)是无缝的,所以在你的数据集还不是很大的时候没必要考虑集群分片(sharding).

#### 52.  分片(sharding)和复制(replication)是怎样工作的?
每一个分片(shard)是一个分区数据的逻辑集合.分片可能由单一服务器或者集群组成,我们推荐为每一个分片(shard)使用集群.

#### 53. 数据在什么时候才会扩展到多个分片(shard)里?
mongodb 分片是基于区域(range)的.所以一个集合(collection)中的所有的对象都被存放到一个块(chunk)中.只有当存在多余一个块的时候,才会有多个分片获取数据的选项.现在,每个默认块的大小是 64mb,所以你需要至少 64 mb 空间才可以实施一个迁移.

#### 54. 可以把movechunk目录里的旧文件删除吗?
没问题,这些文件是在分片(shard)进行均衡操作(balancing)的时候产生的临时文件.一旦这些操作已经完成,相关的临时文件也应该被删除掉.但目前清理工作是需要手动的,所以请小心地考虑再释放这些文件的空间.

#### 55. 如果块移动操作(movechunk)失败了,我需要手动清除部分转移的文档吗?
 　　不需要,移动操作是一致(consistent)并且是确定性的(deterministic);一次失败后,移动操作会不断重试;当完成后,数据只会出现在新的分片里(shard).
 
#### 56. mongodb是否支持事务
　　MongoDB 4.0的新特性——事务（Transactions）：MongoDB 是不支持事务的，因此开发者在需要用到事务的时候，不得不借用其他工具，在业务代码层面去弥补数据库的不足。

　　事务和会话(Sessions)关联，一个会话同一时刻只能开启一个事务操作，当一个会话断开，这个会话中的事务也会结束。

 
 【学习资料】
 
 + [MongoDB面试题](https://www.cnblogs.com/angle6-liu/p/10791875.html)
 + [Mysql及Mongodb](https://my.oschina.net/u/3728166/blog/2875720)
 

